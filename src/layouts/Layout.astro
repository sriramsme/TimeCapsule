---
import { ViewTransitions } from "astro:transitions";
import "@/styles/global.css";
import { SITE } from "@/config";

const googleSiteVerification = import.meta.env.PUBLIC_GOOGLE_SITE_VERIFICATION;

interface Props {
    title?: string;
    description?: string;
    ogImage?: string;
    canonicalURL?: string;
    author?: string;
    noIndex?: boolean;
}

const {
    title = SITE.title,
    description = SITE.desc,
    ogImage = "/og-image.png",
    canonicalURL = new URL(Astro.url.pathname, Astro.url),
    author = `@${SITE.authorUsername}`,
    noIndex = false,
} = Astro.props;

const socialImageURL = new URL(ogImage, Astro.url);

// Structured data for rich results
const structuredData = {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    name: "TimeCapsule",
    description: SITE.desc,
    url: SITE.website,
    applicationCategory: "LifestyleApplication",
    offers: {
        "@type": "Offer",
        price: "0",
        priceCurrency: "USD",
    },
    featureList: [
        "Privacy-first timeline creation",
        "Year-by-year life snapshots",
        "Milestone tracking",
        "Future aspirations planning",
        "Export and share capabilities",
        "Shareable embeds",
    ],
};
---

<!doctype html>
<html lang={SITE.lang}>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="view-transition" content="same-origin" />

        <!-- Favicon -->
        <!-- Favicons -->
        <link
            rel="icon"
            type="image/png"
            sizes="96x96"
            href="/favicon-96x96.png"
        />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/apple-touch-icon.png"
        />

        <!-- Web App Manifest -->
        <link rel="manifest" href="/site.webmanifest" />

        <!-- Canonical URL -->
        <link rel="canonical" href={canonicalURL} />

        <!-- Generator -->
        <meta name="generator" content={Astro.generator} />

        <!-- General Meta Tags -->
        <title>{title}</title>
        <meta name="title" content={title} />
        <meta name="description" content={description} />
        <meta name="author" content={author} />

        <!-- Robots -->
        {noIndex && <meta name="robots" content="noindex, nofollow" />}

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website" />
        <meta property="og:url" content={canonicalURL} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={socialImageURL} />
        <meta property="og:site_name" content="TimeCapsule" />
        <meta property="og:locale" content="en_US" />

        <!-- Twitter -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:url" content={canonicalURL} />
        <meta name="twitter:title" content={title} />
        <meta name="twitter:description" content={description} />
        <meta name="twitter:image" content={socialImageURL} />

        <link
            rel="alternate"
            type="application/json+oembed"
            href={`${SITE.website}/api/oembed?url=${canonicalURL}`}
        />

        <!-- PWA Meta Tags -->
        <meta name="theme-color" content="" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="black-translucent"
        />
        <meta name="apple-mobile-web-app-title" content="TimeCapsule" />

        <!-- Preconnect to external domains for performance -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <!-- Google JSON-LD Structured Data -->
        <script
            type="application/ld+json"
            is:inline
            set:html={JSON.stringify(structuredData)}
        />

        <script is:inline src="/toggle-theme.js"></script>

        {
            // If PUBLIC_GOOGLE_SITE_VERIFICATION is set in the environment variable,
            // include google-site-verification tag in the heading
            // Learn more: https://support.google.com/webmasters/answer/9008080#meta_tag_verification&zippy=%2Chtml-tag
            googleSiteVerification && (
                <meta
                    name="google-site-verification"
                    content={googleSiteVerification}
                />
            )
        }
        <ViewTransitions />
    </head>

    <body>
        <slot />
    </body>
</html>

<style>
    html,
    body {
        margin: 0;
        width: 100%;
        height: 100%;
    }
</style>
